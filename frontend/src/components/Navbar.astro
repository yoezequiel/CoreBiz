---
interface Props {
    activePage?: string;
}

const { activePage } = Astro.props;

const navLinks = [
    { name: "Dashboard", href: "/dashboard", id: "dashboard" },
    { name: "Clientes", href: "/customers", id: "customers" },
    { name: "Ventas", href: "/sales", id: "sales" },
    { name: "Usuarios", href: "/users", id: "users" },
];
---

<nav class="bg-white shadow-sm border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <div class="flex items-center space-x-8">
                <h1 class="text-2xl font-bold text-primary-600">CoreBiz</h1>
                <div class="hidden md:flex space-x-4">
                    {
                        navLinks.map((link) => (
                            <a
                                href={link.href}
                                id={`${link.id}Link`}
                                class:list={[
                                    "px-3 py-2",
                                    activePage === link.id
                                        ? "text-primary-600 font-medium border-b-2 border-primary-600"
                                        : "text-gray-600 hover:text-gray-900",
                                ]}>
                                {link.name}
                            </a>
                        ))
                    }
                </div>
            </div>

            <div class="flex items-center space-x-4">
                <span id="userName" class="text-sm text-gray-700"></span>
                <button
                    id="logoutBtn"
                    class="px-4 py-2 text-sm text-red-600 hover:text-red-700 font-medium">
                    Cerrar Sesi√≥n
                </button>
            </div>
        </div>
    </div>
</nav>

<script>
    import { getUser, clearAuth } from "../lib/api";

    // Set user name in navbar
    const user = getUser();
    const userNameElement = document.getElementById("userName");
    if (userNameElement && user) {
        userNameElement.textContent = user.fullName || user.email;
    }

    // Logout handler
    const logoutBtn = document.getElementById("logoutBtn");
    logoutBtn?.addEventListener("click", () => {
        clearAuth();
        window.location.href = "/";
    });

    // Hide users link if not admin
    if (user && user.role !== "admin") {
        const usersLink = document.getElementById("usersLink");
        if (usersLink) {
            usersLink.style.display = "none";
        }
    }
</script>
